= Sync =

The Python Sync Server is composed of four parts:

* ''server-core'': library containing various helpers. 
* ''server-storage'': the storage server. 
* ''server-reg'': the user registration/management server.
* ''server-full'': a server that reunites the server and the user servers so
you can run everything in a single box.


== Prerequisites ==

The various parts are using Python 2.6 and ''virtualenv''. Make sure your
system have them. Or install them:

* [http://python.org/download/releases/2.6.6 Python 2.6 downloads] 
* [http://pypi.python.org/pypi/virtualenv Virtualenv]

To run the server, you will also need to have these packages installed:

* python-dev
* make
* mercurial
* python-profiler (Debuntu)
* sqlite3 (if you use SQLite -- default)


== Building the full server ==

It is recommended to install the full server. Get the latest version at
https://hg.mozilla.org/services/server-full and run this command:

  $ make build

This command will create an isolated Python environment and pull all the
required dependencies in it. A ''bin'' directory is created and contains a
'''paster'' command that can be used to run the server, using the built-in web
server. 

Running options are kept in an ini-like file that is passed to the
command:

  $ bin/paster serve development.ini 
  Starting server in PID 29951. 
  serving on 0.0.0.0:5000 view at http://127.0.0.1:5000

By default the server is configured to use a SQLite database for the storage
and the user APIs. Once the server is launched, you can point your Firefox Sync
to "http://localhost:5000" and make sure it works.

=== Using MYSQL or LDAP or ... ===

Instead of SQLite, you can use alternative backends:

- Open-LDAP to store the users
- A SQLAlchemy-compatible database, to store the sync data and/or the users

Sync has been tested on MySQL and Postgres.

In order to use a specific Database, you need to install the required
headers, and the required Python library in the local Python environment.

See http://www.sqlalchemy.org/docs/core/engines.html#supported-dbapis

For example, to run everything in MySQL:

1 - install libmysqlclient-dev and mysql-server
2 - install Mysql-Python by running "bin/easy_install Mysql-Python"
3 - change the configuration file located at etc/sync.conf

For #3, see http://docs.services.mozilla.com/configuration.html#configuration-file


== Deploying ==

The built-in server is not to be used if you want to set up a production 
server. You can use different web servers that are compatible with the 
implementation (WSGI-based):

Examples:
- Apache + mod_wsgi
- NGinx + Gunicorn
- lighttpd + flup + fcgi


=== Running behind Apache ===

Here's an example of an Apache setup that uses it:

  <Directory /path/to/sync>
    Order deny,allow
    Allow from all
  </Directory>

  <VirtualHost *:80>
    ServerName example.com
    DocumentRoot /path/to/sync
    WSGIProcessGroup sync
    WSGIDaemonProcess sync user=sync group=sync processes=2 threads=25
    WSGIPassAuthorization On
    WSGIScriptAlias / /path/to/sync/sync.wsgi
    CustomLog /var/log/apache2/example.com-access.log combined
    ErrorLog  /var/log/apache2/example.com-error.log
  </VirtualHost>

This configuration will use the sync.wsgi file located in the project. Make 
sure this file loads the right .ini file.

=== Running behind NGinx ===

XXX


== More documentation, Feedback ==

- Dev guide: http://docs.services.mozilla.com
- IRC channel: #sync. See http://irc.mozilla.org/
- Mailing list: https://mail.mozilla.org/admin/services-dev



